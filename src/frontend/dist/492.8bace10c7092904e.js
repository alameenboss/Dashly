"use strict";(self.webpackChunkdashly=self.webpackChunkdashly||[]).push([[492],{3492:(L,u,a)=>{a.r(u),a.d(u,{FileExplorerModule:()=>G});var s=a(6895),g=a(144),e=a(4650),v=a(1135),F=a(2340),E=a(1042),T=a(529);let C=(()=>{class n{constructor(t){this.http=t,this.map=new Map,this.filesUrl=F.N.apiUrl+"/files"}add(t){return t.id=(0,E.Z)(),this.map.set(t.id,this.clone(t)),t}delete(t){this.map.delete(t)}update(t,o){let i=this.map.get(t);i=Object.assign(i,o),this.map.set(i.id,i)}clear(){this.map=new Map,this.querySubject.next(null)}queryInFolder(t){const o=[];return this.map.forEach(i=>{i.parent===t&&o.push(this.clone(i))}),this.querySubject?this.querySubject.next(o):this.querySubject=new v.X(o),this.querySubject.asObservable()}get(t){return this.map.get(t)}clone(t){return JSON.parse(JSON.stringify(t))}getRootDirectories(){return this.http.get(this.filesUrl+"/getdrives")}getFiles(t){return this.http.get(this.filesUrl+"/GetFiles?path="+t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(T.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var M=a(3546),p=a(5412),f=a(4859),_=a(284),h=a(9549),c=a(4006);let Z=(()=>{class n{constructor(t){this.dialogRef=t}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p.so))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-new-folder-dialog"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[1,"example-full-width"],["matInput","","placeholder","Folder Name",3,"ngModel","ngModelChange"],["mat-raised-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"mat-dialog-close"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Create a new folder"),e.qZA(),e.TgZ(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"input",2),e.NdJ("ngModelChange",function(r){return o.folderName=r}),e.qZA()()(),e.TgZ(5,"mat-dialog-actions")(6,"button",3),e._uU(7,"Cancel"),e.qZA(),e.TgZ(8,"button",4),e._uU(9,"OK"),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("ngModel",o.folderName),e.xp6(4),e.Q6J("mat-dialog-close",o.folderName))},dependencies:[f.lW,_.Nt,h.KE,p.ZT,p.uh,p.xY,p.H8,c.Fj,c.JJ,c.On]}),n})(),y=(()=>{class n{constructor(t){this.dialogRef=t}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p.so))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-rename-dialog"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[1,"example-full-width"],["matInput","","placeholder","Folder Name",3,"ngModel","ngModelChange"],["mat-raised-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"mat-dialog-close"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Rename Element"),e.qZA(),e.TgZ(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"input",2),e.NdJ("ngModelChange",function(r){return o.folderName=r}),e.qZA()()(),e.TgZ(5,"mat-dialog-actions")(6,"button",3),e._uU(7,"Cancel"),e.qZA(),e.TgZ(8,"button",4),e._uU(9,"OK"),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("ngModel",o.folderName),e.xp6(4),e.Q6J("mat-dialog-close",o.folderName))},dependencies:[f.lW,_.Nt,h.KE,p.ZT,p.uh,p.xY,p.H8,c.Fj,c.JJ,c.On]}),n})();var x=a(782),d=a(8255),N=a(7392),U=a(3683);function R(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-icon",3),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.navigateUp())}),e._uU(1,"arrow_back"),e.qZA()}}function w(n,l){1&n&&(e.TgZ(0,"mat-icon",18),e._uU(1,"upload_file"),e.qZA())}function A(n,l){1&n&&(e.TgZ(0,"mat-icon",18),e._uU(1,"folder"),e.qZA())}function J(n,l){1&n&&(e.TgZ(0,"mat-icon",19),e._uU(1,"insert_drive_file"),e.qZA())}const D=function(n){return{element:n}};function b(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-grid-tile",12),e._UZ(1,"span",13,14),e.TgZ(3,"div",15),e.NdJ("click",function(){const r=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.navigate(r))})("contextmenu",function(i){e.CHM(t);const r=e.MAs(2),m=e.oxw();return e.KtG(m.openMenu(i,r))}),e.YNc(4,w,2,0,"mat-icon",16),e.YNc(5,A,2,0,"mat-icon",16),e.YNc(6,J,2,0,"mat-icon",17),e.qZA(),e.TgZ(7,"span"),e._uU(8),e.qZA()()}if(2&n){const t=l.$implicit;e.oxw();const o=e.MAs(12);e.xp6(1),e.Q6J("matMenuTriggerFor",o)("matMenuTriggerData",e.VKq(6,D,t)),e.xp6(3),e.Q6J("ngIf","drive"==t.itemType),e.xp6(1),e.Q6J("ngIf","folder"==t.itemType),e.xp6(1),e.Q6J("ngIf","file"==t.itemType),e.xp6(2),e.Oqu(t.name)}}const O=function(n){return{self:n}};function Q(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",20)(1,"mat-icon"),e._uU(2,"open_with"),e.qZA(),e.TgZ(3,"span"),e._uU(4,"Move To"),e.qZA()(),e.TgZ(5,"button",21),e.NdJ("click",function(){const r=e.CHM(t).element,m=e.oxw();return e.KtG(m.openRenameDialog(r))}),e.TgZ(6,"mat-icon"),e._uU(7,"edit"),e.qZA(),e.TgZ(8,"span"),e._uU(9,"Rename"),e.qZA()(),e.TgZ(10,"button",21),e.NdJ("click",function(){const r=e.CHM(t).element,m=e.oxw();return e.KtG(m.deleteElement(r))}),e.TgZ(11,"mat-icon"),e._uU(12,"delete"),e.qZA(),e.TgZ(13,"span"),e._uU(14,"Delete"),e.qZA()()}if(2&n){const t=l.element;e.oxw();const o=e.MAs(15);e.Q6J("matMenuTriggerFor",o)("matMenuTriggerData",e.VKq(2,O,t))}}function S(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw().self,m=e.oxw();return e.KtG(m.moveElement(r,i))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.name)}}function q(n,l){if(1&n&&(e.ynx(0),e.YNc(1,S,2,1,"button",23),e.BQk()),2&n){const t=l.$implicit,o=e.oxw().self;e.xp6(1),e.Q6J("ngIf","folder"==t.itemType&&t.id!==o.id)}}function I(n,l){if(1&n&&e.YNc(0,q,2,1,"ng-container",22),2&n){const t=e.oxw();e.Q6J("ngForOf",t.fileElements)}}let Y=(()=>{class n{constructor(t){this.dialog=t,this.folderAdded=new e.vpe,this.elementRemoved=new e.vpe,this.elementRenamed=new e.vpe,this.elementMoved=new e.vpe,this.navigatedDown=new e.vpe,this.navigatedUp=new e.vpe}ngOnInit(){}deleteElement(t){this.elementRemoved.emit(t)}navigate(t){("folder"==t.itemType||"drive"==t.itemType)&&this.navigatedDown.emit(t)}navigateUp(){this.navigatedUp.emit()}moveElement(t,o){this.elementMoved.emit({element:t,moveTo:o})}openNewFolderDialog(){this.dialog.open(Z).afterClosed().subscribe(o=>{o&&this.folderAdded.emit({name:o})})}openRenameDialog(t){this.dialog.open(y).afterClosed().subscribe(i=>{i&&(t.name=i,this.elementRenamed.emit(t))})}openMenu(t,o){t.preventDefault(),o.openMenu()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(p.uw))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-file-explorer"]],inputs:{fileElements:"fileElements",canNavigateUp:"canNavigateUp",path:"path"},outputs:{folderAdded:"folderAdded",elementRemoved:"elementRemoved",elementRenamed:"elementRenamed",elementMoved:"elementMoved",navigatedDown:"navigatedDown",navigatedUp:"navigatedUp"},decls:17,vars:4,consts:[["class","pointer",3,"click",4,"ngIf"],[2,"margin-left","8px"],[1,"spacer"],[1,"pointer",3,"click"],["fxFlex","","fxLayout","row","fxLayoutAlign","space-between stretch",1,"container"],["fxFlex","","fxLayout","row",1,"content"],["cols","4","rowHeight","50px","fxFlex",""],["class","file-or-folder",4,"ngFor","ngForOf"],[3,"overlapTrigger"],["rootMenu","matMenu"],["matMenuContent",""],["moveToMenu","matMenu"],[1,"file-or-folder"],[3,"matMenuTriggerFor","matMenuTriggerData"],["menuTrigger","matMenuTrigger"],["fxLayout","column","fxLayoutAlign","space-between center",3,"click","contextmenu"],["color","accent","class","file-or-folder-icon pointer",4,"ngIf"],["color","primary","class","file-or-folder-icon pointer",4,"ngIf"],["color","accent",1,"file-or-folder-icon","pointer"],["color","primary",1,"file-or-folder-icon","pointer"],["mat-menu-item","",3,"matMenuTriggerFor","matMenuTriggerData"],["mat-menu-item","",3,"click"],[4,"ngFor","ngForOf"],["mat-menu-item","",3,"click",4,"ngIf"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-toolbar"),e.YNc(1,R,2,0,"mat-icon",0),e.TgZ(2,"span",1),e._uU(3),e.qZA(),e._UZ(4,"span",2),e.TgZ(5,"mat-icon",3),e.NdJ("click",function(){return o.openNewFolderDialog()}),e._uU(6,"create_new_folder"),e.qZA()(),e.TgZ(7,"div",4)(8,"div",5)(9,"mat-grid-list",6),e.YNc(10,b,9,8,"mat-grid-tile",7),e.qZA()()(),e.TgZ(11,"mat-menu",8,9),e.YNc(13,Q,15,4,"ng-template",10),e.qZA(),e.TgZ(14,"mat-menu",null,11),e.YNc(16,I,1,1,"ng-template",10),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.canNavigateUp),e.xp6(2),e.Oqu(o.path||"Files"),e.xp6(7),e.Q6J("ngForOf",o.fileElements),e.xp6(1),e.Q6J("overlapTrigger",!1))},dependencies:[s.sg,s.O5,x.Il,x.DX,d.VK,d.OP,d.KA,d.p6,N.Hw,U.Ye],styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.file-or-folder[_ngcontent-%COMP%]{padding:8px;overflow:hidden}.file-or-folder-icon[_ngcontent-%COMP%]{width:32px;height:32px;font-size:32px}.pointer[_ngcontent-%COMP%]{cursor:pointer}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),n})();const P=[{path:"",component:(()=>{class n{constructor(t){this.fileExplorerService=t,this.canNavigateUp=!1}ngOnDestroy(){this.fileExplorerService.clear(),this.updateFileElementQuery()}ngOnInit(){this.fileExplorerService.getRootDirectories().subscribe(t=>{t?.forEach(o=>{this.fileExplorerService.add({name:o.replace("\\",""),itemType:"drive",parent:"root"})}),this.updateFileElementQuery()})}addFolder(t){this.fileExplorerService.add({itemType:"folder",name:t.name,parent:this.currentRoot?this.currentRoot.id:"root"}),this.updateFileElementQuery()}removeElement(t){this.fileExplorerService.delete(t.id),this.updateFileElementQuery()}navigateToFolder(t){this.currentRoot=t,this.updateFileElementQuery(),this.currentPath=this.pushToPath(this.currentPath,t.name),console.log(t),this.fileExplorerService.getFiles(this.currentPath).subscribe(o=>{console.log(o),o.folders?.forEach(i=>{this.fileExplorerService.add({name:i,itemType:"folder",parent:t.id})}),o.files?.forEach(i=>{this.fileExplorerService.add({name:i,itemType:"file",parent:t.id})}),this.updateFileElementQuery()}),this.canNavigateUp=!0}navigateUp(){this.currentRoot&&"root"===this.currentRoot.parent?(this.currentRoot=null,this.canNavigateUp=!1,this.updateFileElementQuery()):(this.currentRoot=this.fileExplorerService.get(this.currentRoot.parent),this.updateFileElementQuery()),this.currentPath=this.popFromPath(this.currentPath)}moveElement(t){this.fileExplorerService.update(t.element.id,{parent:t.moveTo.id}),this.updateFileElementQuery()}renameElement(t){this.fileExplorerService.update(t.id,{name:t.name}),this.updateFileElementQuery()}updateFileElementQuery(){this.fileElements=this.fileExplorerService.queryInFolder(this.currentRoot?this.currentRoot.id:"root")}pushToPath(t,o){let i=t||"";return i+=`${o}/`,i}popFromPath(t){let o=t||"",i=o.split("/");return i.splice(i.length-2,1),o=i.join("/"),o}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-file-explorer-main"]],decls:3,vars:5,consts:[[2,"height","100%","box-sizing","border-box","padding","0"],[3,"fileElements","path","canNavigateUp","folderAdded","elementRemoved","navigatedDown","navigatedUp","elementRenamed","elementMoved"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-card",0)(1,"app-file-explorer",1),e.NdJ("folderAdded",function(r){return o.addFolder(r)})("elementRemoved",function(r){return o.removeElement(r)})("navigatedDown",function(r){return o.navigateToFolder(r)})("navigatedUp",function(){return o.navigateUp()})("elementRenamed",function(r){return o.renameElement(r)})("elementMoved",function(r){return o.moveElement(r)}),e.ALo(2,"async"),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("fileElements",e.lcZ(2,3,o.fileElements))("path",o.currentPath)("canNavigateUp",o.canNavigateUp))},dependencies:[M.a8,Y,s.Ov]}),n})(),data:{breadcrumb:""}}];let K=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.Bz.forChild(P),g.Bz]}),n})();var j=a(3871),H=a(4466);let G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[s.ez,K,j.q,c.u5,c.UX,H.m]}),n})()}}]);